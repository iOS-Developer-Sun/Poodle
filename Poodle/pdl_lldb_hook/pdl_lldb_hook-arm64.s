//
//  pdl_lldb_hook.c
//  Poodle
//
//  Created by Poodle on 2019/12/19.
//  Copyright Â© 2019 Poodle. All rights reserved.
//

#if __arm64__

#include <mach/vm_param.h>

.text

.private_extern _pdl_lldb_hook_page_begin
.private_extern _pdl_lldb_hook_page_end

.align PAGE_MAX_SHIFT

.macro PDL_LLDB_HOOK_ENTRY
    nop
    nop
    nop
    adr x9, -PAGE_MAX_SIZE
    ldr x9, [x9]
    br x9
.endmacro

.macro PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY

    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY

    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY

    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY
.endmacro

.macro PDL_LLDB_HOOK_ENTRY_256
    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16

    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16

    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16

    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16
.endmacro

_pdl_lldb_hook_page_begin:
    PDL_LLDB_HOOK_ENTRY_256
    PDL_LLDB_HOOK_ENTRY_256

    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16

    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16

    PDL_LLDB_HOOK_ENTRY_16
    PDL_LLDB_HOOK_ENTRY_16

    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY

    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY

    PDL_LLDB_HOOK_ENTRY
    PDL_LLDB_HOOK_ENTRY

_pdl_lldb_hook_page_end:
    nop
    nop
    nop
    nop

#endif
